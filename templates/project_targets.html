{% extends "base.html" %}

{% block title %}{{ _('Target Percentage') }}{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>{{ _('Set target percentage per project') }}</h2>
    <div>
        {% set current_year = year %}
        {% set current_month = month %}
        <form style="display: inline-flex; gap: 10px;" method="GET">
            <select name="month" style="width: auto;">
                <option value="1" {% if month == 1 %}selected{% endif %}>{{ _('January') }}</option>
                <option value="2" {% if month == 2 %}selected{% endif %}>{{ _('February') }}</option>
                <option value="3" {% if month == 3 %}selected{% endif %}>{{ _('March') }}</option>
                <option value="4" {% if month == 4 %}selected{% endif %}>{{ _('April') }}</option>
                <option value="5" {% if month == 5 %}selected{% endif %}>{{ _('May') }}</option>
                <option value="6" {% if month == 6 %}selected{% endif %}>{{ _('June') }}</option>
                <option value="7" {% if month == 7 %}selected{% endif %}>{{ _('July') }}</option>
                <option value="8" {% if month == 8 %}selected{% endif %}>{{ _('August') }}</option>
                <option value="9" {% if month == 9 %}selected{% endif %}>{{ _('September') }}</option>
                <option value="10" {% if month == 10 %}selected{% endif %}>{{ _('October') }}</option>
                <option value="11" {% if month == 11 %}selected{% endif %}>{{ _('November') }}</option>
                <option value="12" {% if month == 12 %}selected{% endif %}>{{ _('December') }}</option>
            </select>
            <input type="number" name="year" value="{{ year }}" style="width: 80px;">
            <button type="submit" class="btn">{{ _('Show') }}</button>
        </form>
    </div>
</div>

<div style="background: #fafafa; padding: 25px; border: 1px solid #ddd; margin-bottom: 30px;">
    <h3>{{ _('Set target percentage for') }} {{ year }}-{% if month < 10 %}0{% endif %}{{ month }}</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
        {% for project in projects %}
        <form method="POST" class="form-group">
            <label>{{ project.name }}</label>
            <input type="hidden" name="project_id" value="{{ project.id }}">
            <div style="display: flex; gap: 10px;">
                <input type="number" 
                       name="target_percentage" 
                       value="{{ target_map.get(project.id, {}).get('percentage', '') }}"
                       min="0"
                       max="100"
                       step="0.1"
                       placeholder="0-100%"
                       style="flex: 1;">
                <button type="submit" class="btn" style="width: auto;">{{ _('Save') }}</button>
            </div>
        </form>
        {% endfor %}
    </div>
</div>

<h3>{{ _('Current targets') }} {{ year }}-{% if month < 10 %}0{% endif %}{{ month }}</h3>
{% if targets %}
<table>
    <thead>
        <tr>
            <th>{{ _('Name') }}</th>
            <th>{{ _('Target %') }}</th>
            <th>{{ _('Action') }}</th>
        </tr>
    </thead>
    <tbody>
        {% for target in targets %}
        <tr>
            <td><strong>{{ target.project.name }}</strong></td>
            <td style="text-align: center;">{{ target.target_percentage }}%</td>
            <td>
                <a href="{{ url_for('delete_target', target_id=target.id) }}" class="btn btn-danger">{{ _('Delete') }}</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p style="text-align: center; padding: 40px; color: #999;">{{ _('No targets set for this month yet.') }}</p>
{% endif %}
{% endblock %}
